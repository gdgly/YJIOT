<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
<meta name="description" content="">
<meta name="author" content="">
<title></title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/register.css">
<link href="iconfont/style.css" type="text/css" rel="stylesheet">
<script src="../../compontents/jquery/js/jquery.min.js"></script>
<script src="../../compontents/iot/js/config.js?v=1.0.0"></script>
<script src="../../compontents/iot/js/api.js?v=1.0.0"></script>
<script src="../../compontents/iot/js/iot.js?v=1.0.0"></script>
<script src="../../compontents/iot/js/power.js?v=1.0.0"></script>

</head>
<style>

</style>
<body>
	<div class="registerBg">
		<!---container-->
		<div class="container" style="width: 300px;">
			<div class="register-a">
				<h2>亿享云</h2>
			</div>
			      <form>
                    <div class="form-group mg-t20">
                        <i class="icon-user icon_font"></i>
                        <input type="usernmane" class="login_input"  id="login-name"  placeholder="请输入用户名" />
                    </div>
                    <div class="form-group mg-t20">
                        <i class="icon-lock icon_font"></i>
                        <input  type="password" class="login_input" id="login-pass"  placeholder="请输入密码" />
                    </div>
                    <button type="button" class="login_btn"  onclick="onLogin()">登 录</button>
               </form>

			<div class="register-a" style="margin-top: -20px;">
				<img src="images/BG3.png" 
					class="register-ad" style="width: 260px"> 
			</div>


		</div>
		<!--//container-->

	</div>
</body>
<script>           
	function onLogin() {
		var username = $('#login-name').val();
		var password = $('#login-pass').val();
		var data = {
			"username" : username,
			"password" : password
		};
	
		$pow.login(data, success, error);
		function success(ret) {
			var username = data.username;
			var appList = ret.appList;
			$api.saveToken(username, '');
			$api.saveCurrApp(appList[0].appId);
			$api.saveApps(appList);
			//initToken();
			window.location.href = '../main.html';
		}
		function error() {
		alert('温馨提示账号过密码有误!请核实...');
		//openAlert('温馨提示', '账号过密码有误!请核实...');
		}
		;

	}
	
</script>
<script>
	function initToken() {
	var user = $api.getToken();
	var APPID = $api.getCurrApp();
		var data = {};
		data.userName = user.username;
		data.appId = APPID;
		$pow.getToken(data, function(ret) {
			$api.saveToken(user.username, ret.token);
			var data = {};
			data.username = user.username;
			$pow.selSysUser(data, function(ret) {
				if(ret.sysUser.status==0){
				alert('温馨提示该用户已停用！请联系管理员开通');
				}else{
					window.location.href = '../main.html';
				}
			},
				function(e) {
					alert('温馨提示当前用户状态查询有误');
				})
		},
			function() {
					alert('温馨提示token失效');
			});
	}

</script>

</html>
