C51 COMPILER V9.52.0.0   TIMER                                                             09/18/2017 11:41:21 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\User\timer\timer.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\User;..\User\le
                    -d;..\User\touch;..\User\timer;..\User\inc) DEBUG OBJECTEXTEND PRINT(.\Listings\timer.lst) TABS(2) OBJECT(.\Objects\timer
                    -.obj)

line level    source

   1          #include "timer.h"
   2          #include "global.h"
   3          #include "led.h"
   4          #include "touch.h"
   5          /*
   6          //时钟周期 22.1184MHz
   7          1秒的机器周期为 22118400
   8          1ms的需要的机器周期为 22118.4
   9          
  10          22118.4/12 = 1843.2(0x0733)
  11          
  12          65536 - 22118 = 43418（0xA99A）
  13          
  14          65536 - 1843 = 43418（0xF8CD）
  15          
  16          
  17          
  18          */
  19          
  20          
  21          extern KEY_INFO_Typedef key_info;
  22          
  23          extern LED_BLINK_Typedef led_blink_info;
  24          
  25          
  26          
  27          void TIMER0_initialize(void)  //Initialize TIMER0
  28          {
  29   1          IEN0 |= (ET2<<5)|(ET1<<3)|(ET0<<1); //IE=IEN0
  30   1          TMOD  = d_T0MOD;
  31   1          TH0   = d_T0_TH0;  //MODE1 16bit
  32   1          TL0   = d_T0_TL0;
  33   1      }
  34          
  35          
  36          void Start_Timer0(void)
  37          {
  38   1          TIMER0_initialize();
  39   1          
  40   1          EA   = 1;
  41   1          TR0  = 1;
  42   1      }
  43          
  44          
  45          void TIMER0_ISR(void) interrupt TIMER0_VECTOR
  46          {
  47   1          // To do something by using timer interrupt.
  48   1          static unsigned char times2ms = 2;
  49   1          static unsigned char times10ms = 10;
  50   1          static unsigned int times1000ms = 1000;
  51   1        
  52   1          if(--times2ms == 0)
  53   1          {
C51 COMPILER V9.52.0.0   TIMER                                                             09/18/2017 11:41:21 PAGE 2   

  54   2              g_2ms_flag = 1;
  55   2              times2ms = 2;
  56   2          }
  57   1        
  58   1          if(--times10ms == 0)
  59   1          {
  60   2              g_10ms_flag = 1;
  61   2              times10ms = 10;
  62   2          }
  63   1          
  64   1          if(--times1000ms == 0)
  65   1          {
  66   2              g_1000ms_flag = 1;
  67   2              times1000ms = 1000;
  68   2          }  
  69   1      
  70   1          if(key_info.IsCount == 1)
  71   1          {
  72   2              key_info.count_1ms_times++;
  73   2          } 
  74   1      
  75   1          if(led_blink_info.IsLedBlink == 1)
  76   1          {
  77   2              led_blink_info.ledcount_1ms_times++;
  78   2              if(led_blink_info.ledcount_1ms_times == LED_OFF_TIMES)
  79   2              {
  80   3                  led_blink_info.ledstate = LED_OFF;
  81   3              }
  82   2              else if(led_blink_info.ledcount_1ms_times == LED_ON_TIMES)
  83   2              {
  84   3                  led_blink_info.ledstate = LED_ON;
  85   3              }
  86   2              else
  87   2              {
  88   3                  led_blink_info.ledstate = LED_NONE;
  89   3              }
  90   2          }      
  91   1      
  92   1          TH0   = d_T0_TH0;  //MODE1 16bit
  93   1          TL0   = d_T0_TL0;
  94   1          TR0 = 1;
  95   1          
  96   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    137    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
