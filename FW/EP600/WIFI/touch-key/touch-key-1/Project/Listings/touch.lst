C51 COMPILER V9.52.0.0   TOUCH                                                             09/18/2017 11:41:21 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE TOUCH
OBJECT MODULE PLACED IN .\Objects\touch.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\User\touch\touch.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\User;..\User\le
                    -d;..\User\touch;..\User\timer;..\User\inc) DEBUG OBJECTEXTEND PRINT(.\Listings\touch.lst) TABS(2) OBJECT(.\Objects\touch
                    -.obj)

line level    source

   1          /*
   2          *按键说明：芯片中有3个寄存器 STATUS2 STATUS1 STATUS0
   3           每个STATUS寄存器对应8个按键，其中每一位对应一个按键
   4           STATUS0对应按键KEY1-KEY7 8个通道
   5           STATUS1对应按键KEY8-KEY15 共8个通道
   6           STATUS2对应按键KEY16-KEY24共8个通道
   7           
   8           POWER按键对应通道1，按下后STATUS0的bit1置1，即STATUS0 = 2
   9           SPEED按键对应的按键KEY8，第8通道，按下后 STATUS1 的bit0置位，即  STATUS1 = 1
  10           TIMER按键对应的按键KEY9，第9通道，按下后 STATUS1 的bit1置位，即  STATUS1 = 2
  11           MODE按键对应的按键KEY10，第10通道，按下后 STATUS1 的bit2置位，即 STATUS1 = 4
  12           因SPEED、TIMER和MODE按键都用STATUS1表示，所有当两个按键同时按下时对应的标志位都置1
  13           例如：TMIER和MODE同时按下时 STATUS1 = 2 + 4 = 6
  14          */
  15          
  16          
  17          #include "OB39A08T1.h"
  18          #include "touch.h"
  19          #include "global.h"
  20          
  21          //typedef struct{
  22          //  
  23          //  unsigned char IsCount;
  24          //  unsigned char count_1ms_times;
  25          //  unsigned char IsTouchedKey;
  26          //  unsigned char WhichKey;
  27          
  28          //}KEY_INFO_Typedef;
  29          
  30          
  31          KEY_INFO_Typedef key_info;
  32          
  33          
  34          unsigned char Scan_TouchPad(void)
  35          {
  36   1          unsigned char whichkey = 0;
  37   1          unsigned char temp_status0,temp_status1 = 0;
  38   1          static unsigned char last_status0,last_status1 = 0;
  39   1        
  40   1          temp_status0 = STATUS0;
  41   1          temp_status1 = STATUS1;
  42   1        
  43   1          //POWER按键和其他按键不能同时按下
  44   1          if((temp_status0 == 0 && temp_status1 == 0) || (temp_status0 != 0 && temp_status1 != 0))
  45   1          {
  46   2              last_status0 = 0;
  47   2              last_status1 = 0;
  48   2              return 0;
  49   2          }
  50   1          
  51   1          if(temp_status0 != 0)
  52   1          {
  53   2              if(temp_status0 != last_status0)
C51 COMPILER V9.52.0.0   TOUCH                                                             09/18/2017 11:41:21 PAGE 2   

  54   2              {
  55   3                  key_info.IsCount = 1;
  56   3                  key_info.count_1ms_times = 0;
  57   3                  key_info.IsTouchedKey = 0;
  58   3                  key_info.WhichKey = KEY_NONE;
  59   3              }
  60   2          }
  61   1          
  62   1          if(temp_status1 != 0)
  63   1          {
  64   2              if(temp_status1 != last_status1)
  65   2              {
  66   3                  key_info.IsCount = 1;
  67   3                  key_info.count_1ms_times = 0;
  68   3                  key_info.IsTouchedKey = 0;
  69   3                  key_info.WhichKey = KEY_NONE;
  70   3              }
  71   2          }
  72   1          
  73   1          if(key_info.count_1ms_times >= KEY_TOUCH_MS_TIMES)
  74   1          {
  75   2              //一个按键计数完毕后停止计数，防止一直按着一个按键不松开
  76   2              key_info.IsCount = 0;
  77   2              key_info.count_1ms_times = 0;
  78   2              
  79   2              if(temp_status0 != 0)
  80   2              {
  81   3                  if(temp_status0 == KEY_POWER_VALUE)
  82   3                  {
  83   4                      key_info.IsTouchedKey = 1;
  84   4                      key_info.WhichKey = KEY_POWER;
  85   4                  }
  86   3                  else
  87   3                  {
  88   4                      key_info.IsTouchedKey = 0;
  89   4                      key_info.WhichKey = KEY_NONE;
  90   4                  }
  91   3              }
  92   2              
  93   2              if(temp_status1 != 0)
  94   2              {
  95   3                  if(temp_status1 == KEY_SPEED_VALUE)
  96   3                  {
  97   4                      key_info.IsTouchedKey = 1;
  98   4                      key_info.WhichKey = KEY_SPEED;
  99   4                  }
 100   3                  else if(temp_status1 == KEY_TIMER_VALUE)
 101   3                  {
 102   4                      key_info.IsTouchedKey = 1;
 103   4                      key_info.WhichKey = KEY_TIMER;
 104   4                  }
 105   3                  else if(temp_status1 == KEY_MODE_VALUE)
 106   3                  {
 107   4                      key_info.IsTouchedKey = 1;
 108   4                      key_info.WhichKey = KEY_MODE;
 109   4                  }    
 110   3                  else if(temp_status1 == KEY_WIFI_VALUE)
 111   3                  {
 112   4                      key_info.IsTouchedKey = 1;
 113   4                      key_info.WhichKey = KEY_WIFI;
 114   4                  }              
 115   3                  else
C51 COMPILER V9.52.0.0   TOUCH                                                             09/18/2017 11:41:21 PAGE 3   

 116   3                  {
 117   4                      key_info.IsTouchedKey = 0;
 118   4                      key_info.WhichKey = KEY_NONE;            
 119   4                  }
 120   3              }
 121   2              
 122   2      
 123   2          
 124   2          }
 125   1          
 126   1      
 127   1         
 128   1          
 129   1          last_status0 = temp_status0;    
 130   1          last_status1 = temp_status1;
 131   1          
 132   1          return key_info.WhichKey;
 133   1      }
 134          
 135          
 136          
 137          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    160    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
