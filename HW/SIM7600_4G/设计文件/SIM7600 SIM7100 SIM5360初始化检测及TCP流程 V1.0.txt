//硬件上一定要把给模块断电的功能加上！

//如果是一个单独电源芯片给模块供电，可以把电源芯片的使能脚引到MCU上，控制模块断电，如果这样不行，建议用MOS管做开关，由MCU控制MOS管，给模块断电。MOS管压降只有0.1V，而且MOS管能通过的电流大。需要重启时，正常情况下，使用POWERKEY关机开机来重启模块，但我们不排除在极端情况下，POWERKEY无效，这时RESET也可能无效，就需要给模块断电来解决。而反复断电可能导致模块文件系统损坏

//即：需要重启模块时，正常情况用POWERKEY，POWERKEY 无效再断电



//初始化流程!
//1.开机之后循环发送"AT"，每500毫秒发一次，一般发两三个之后就能收到OK了，表示串口通了
//2.收到正确应答后，发AT+CPIN?，如果没收到正确应答，就循环发送，每500毫秒发一次，最多发20次
//3.当AT+CPIN?收到正确应答后，发AT+CSQ，如果没收到正确应答，就循环发送，每500毫秒发一次，最多发100次
//4.当AT+CSQ收到正确应答后(CSQ的值只要是非零就是正确应答)，发AT+CGREG?，如果没收到正确应答，就循环发送，每500毫秒发一次，最多发100次
//5.当AT+CGREG?收到正确应答后(0,1和0,5都是正确应答)，表示模块初始化及注册网络已成功，这时才可进行数据连接！
//注意!以上初始化流程必须执行，当模块处于网络不好的条件下，注册时间会延长，如果不执行，可能会在不知道模块是否已注册上网络的情况下开始数据连接，
//导致数据连接不成功，不成功后重启模块，又重连，导致反复重启死循环
//以上命令超时时间为500毫秒，如果发送AT命令500毫秒后仍得不到响应，视为超时。
//所有AT命令均可在AT手册中搜到，以查看具体用法


//以上初始化流程在所有对7100的应用中都必须加上


//以下命令回复的超时时间除了特别说明的，剩下全为500毫秒
//发送 AT，测试串口或USB口是否通
AT
OK
//查询SIM卡是否已准备就绪
AT+CPIN?
+CPIN: READY//必须判断READY与否

OK//不能判断OK
//查询信号强度
AT+CSQ
+CSQ: 17,99//必须判断前一个数字，来确定信号强度，比如这里是17（范围0-31，31表示信号最强），后一个数字不用判断

OK//不能判断OK
//查询网络是否附着上
AT+CGREG?
+CGREG: 0,1//必须判断0,1或0,5才是正确的

OK//不能判断OK，0,1/0,2/0,3/0,5等等都会回OK
//到此初始化检测通过，说明模块可以正常工作了
//查询版本号
AT+SIMCOMATI
Manufacturer: SIMCOM INCORPORATED
Model: SIMCOM_SIM7100C
Revision: 4534B03SIM7100C
SIM7100C_4534_150326_V1.00
QCN: 
IMEI: 866154020007660
+GCAP: +CGSM
DeviceInfo: 200,170

OK
//查询网络设置
AT+CNMP?
+CNMP: 2

OK
//查询当前网络
AT+CPSI?
+CPSI: LTE,Online,460-00,0x1816,27551521,245,EUTRAN-BAND40,38950,5,5,-68,-1046,-778,19

OK
//CMNET是中国移动，3GNET是联通，电信是CTNET
AT+CGDCONT=1,"IP","CMNET"
OK
AT+CSOCKSETPN=1
OK
AT+CIPMODE=0
OK
AT+NETOPEN
OK//不能判断OK

+NETOPEN: 0//默认超时时间120秒，必须出现0，才说明NETOPEN成功，如果该数字不是0，说明打开失败
AT+IPADDR
+IPADDR: 10.21.110.228//只要有IP，就说明NETOPEN成功

OK
AT+CIPOPEN=0,"TCP","116.247.119.165",9336//非阻塞式 
OK//不能判断OK

+CIPOPEN: 0,0//默认超时时间120秒，这条表示在通道0上，链接服务器成功。前一个数字表示通道号，后一个数字必须为0，才说明CIPOPEN成功，如果该数字不是0，说明CIPOPEN失败
AT+CIPSEND=0,5
>ABCDE
OK//不能判断OK

+CIPSEND: 0,5,5//默认超时时间120秒，这条表示在通道0上，要发5个，实际也发送了5个，需要判断收到这条，才表示发送成功
